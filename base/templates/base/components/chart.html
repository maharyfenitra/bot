<style>
    /* Style the chart container */
    #chart-container {
        width: 100%;
        height: 70vh;
        margin: 0 auto;
    }
</style>
<!-- Container for the chart -->
<div id="chart-container"></div>
    
<!-- Dropdown menu for selecting timeframes -->
<div>
    <label for="timeframe">Select Timeframe:</label>
    <select id="timeframe">
        <option value="1m">1 Minute</option>
        <option value="5m">5 Minutes</option>
        <option value="15m">15 Minutes</option>
        <option value="30m">30 Minutes</option>
        <option value="1h">1 Hour</option>
        <option value="4h">4 Hours</option>
        <option value="1d">1 Day</option>
        <option value="1w">1 Week</option>
        <option value="1M">1 Month</option>
    </select>
</div>

<!-- Script to fetch historical data from Binance REST API -->
<script>
    // Create a new chart
    const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
        width: document.getElementById('chart-container').offsetWidth, // Set chart width to container width
        height: document.getElementById('chart-container').offsetHeight, // Set chart height to container height
        layout: {
            backgroundColor: '#f0f4f8', // Set background color
        },
        priceScale: {
            borderColor: '#d1d4dc', // Set border color for price scale
        },
        timeScale: {
            borderColor: '#d1d4dc', // Set border color for time scale
        },
    });

    // Add a candlestick series to the chart
    const candleSeries = chart.addCandlestickSeries();

    // Function to fetch historical data for the selected timeframe
    function fetchHistoricalData(timeframe) {
        fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${timeframe}&limit=1000`)
            .then(response => response.json())
            .then(data => {
                // Format historical data for the chart
                const formattedData = data.map(item => ({
                    time: item[0] / 1000, // Convert timestamp to seconds
                    open: parseFloat(item[1]),
                    high: parseFloat(item[2]),
                    low: parseFloat(item[3]),
                    close: parseFloat(item[4]),
                }));
                // Update the chart with historical data
                candleSeries.setData(formattedData);
            })
            .catch(error => {
                console.error('Error fetching historical data:', error);
            });
    }

    // Initial fetch for 1-minute timeframe
    fetchHistoricalData('1m');

    // Open a WebSocket connection to Binance
    const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@kline_1m');

    // Handle messages received from the WebSocket
    ws.onmessage = function (event) {
        const message = JSON.parse(event.data);
        const candle = {
            time: message.k.t / 1000, // Convert timestamp to seconds
            open: parseFloat(message.k.o),
            high: parseFloat(message.k.h),
            low: parseFloat(message.k.l),
            close: parseFloat(message.k.c),
        };
        candleSeries.update(candle); // Update the chart with the new candlestick
    };

    // Event listener for timeframe selection
    document.getElementById('timeframe').addEventListener('change', function() {
        const selectedTimeframe = this.value;
        fetchHistoricalData(selectedTimeframe); // Fetch historical data for the selected timeframe
    });
</script>